<ion-header>
  <ion-toolbar color="scheduling">
    <ion-title>Scheduling</ion-title>
    <ion-buttons slot="start">
      <ion-menu-button
        *ngIf="scheduling.internalStatus == 'New'"
      ></ion-menu-button>
      <ion-back-button
        defaulthref=""
        *ngIf="scheduling.internalStatus != 'New'"
      >
      </ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form novalidate>
    <!-- <ion-item *ngIf="scheduling.syncInfo.isSync">
 TODO: insert url to open in bitrix
   </ion-item> -->
    <ion-item>
      <ion-label position="floating">Select Service</ion-label>
      <ion-select
        interface="popover"
        name="serviceType"
        [disabled]="scheduling.syncInfo.isSync"
        #serviceType="ngModel"
        [(ngModel)]="scheduling.serviceType"
      >
        <ion-select-option value="ITEST"
          >Environmental (ITest)</ion-select-option
        >
        <ion-select-option disabled value="Expert Networks"
          >Comprehensive (ExpertNetwork)</ion-select-option
        >
      </ion-select>
    </ion-item>

    <!-- <ion-item lines="none">
    
    </ion-item> -->
    <ion-item lines="none">
      <ion-label>Contact </ion-label>

      <ion-icon
        *ngIf="!scheduling.contact.firstName"
        color="danger"
        name="information-circle-outline"
      ></ion-icon>
    </ion-item>
    <ion-item lines="none" *ngIf="!scheduling.syncInfo.isSync">
      <ion-chip
        [disabled]="!scheduling.serviceType"
        color="primary"
        (click)="searchContact('inspectionContact')"
        slot="end"
      >
        <ion-label>Search or Create New Contact </ion-label>
        <ion-icon name="person-circle-outline"></ion-icon>
      </ion-chip>
    </ion-item>

    <ion-item *ngIf="scheduling.contact.firstName">
      <ion-avatar slot="start">
        <img src="../../../assets/images/avatar.svg" />
      </ion-avatar>
      <ion-label>
        <h3>
          {{scheduling.contact.firstName + " " + scheduling.contact.lastName}}
        </h3>
        <p>{{scheduling.contact.phone}}</p>
        <p>{{scheduling.contact.email}}</p>
      </ion-label>
    </ion-item>

    <ion-item lines="full">
      <ion-label position="floating">Address</ion-label>
      <ion-input
        name="serviceAddress"
        #serviceAddress="ngModel"
        [(ngModel)]="scheduling.serviceAddress"
        type="text"
        [disabled]="scheduling.syncInfo.isSync"
        required
      ></ion-input>
    </ion-item>
    <div class="validation-errors">
      <div
        *ngIf="serviceAddress.errors && (serviceAddress.dirty || serviceAddress.touched) "
      >
        <p *ngIf="serviceAddress.errors.required">
          <ion-icon color="danger" name="information-circle-outline"></ion-icon>
          <ion-label color="danger"> Required </ion-label>
        </p>
      </div>
    </div>
    <div id="types" *ngIf="scheduling.serviceType">
      <app-multiple-radio
        title="Inspection Types"
        ngDefaultControl
        name="inspectionTypes"
        [readonly]="scheduling.syncInfo.isSync"
        [options]="inspectionTypes"
        [(data)]="scheduling.inspectionTypes"
      ></app-multiple-radio>
    </div>

    <ion-item lines="full">
      <ion-label position="floating">Inspector Instructions</ion-label>
      <ion-textarea
        name="notes"
        #notes="ngModel"
        [disabled]="scheduling.syncInfo.isSync"
        [(ngModel)]="scheduling.notes"
        type="text"
      ></ion-textarea>
    </ion-item>

    <ion-item lines="full">
      <ion-label position="floating">Type of Loss & Description</ion-label>
      <ion-textarea
        name="typeOfLossDesc"
        #typeOfLossDesc="ngModel"
        [disabled]="scheduling.syncInfo.isSync"
        [(ngModel)]="scheduling.typeOfLossDesc"
        type="text"
      ></ion-textarea>
    </ion-item>

    <ion-item lines="full">
      <ion-label position="floating">Affected Area</ion-label>
      <ion-textarea
        name="affectedArea"
        #affectedArea="ngModel"
        [disabled]="scheduling.syncInfo.isSync"
        [(ngModel)]="scheduling.affectedArea"
        type="text"
      ></ion-textarea>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Water Damage Category</ion-label>
      <ion-select
        interface="popover"
        name="waterDamageCategory"
        #waterDamageCategory="ngModel"
        [disabled]="scheduling.syncInfo.isSync"
        [(ngModel)]="scheduling.waterDamageCategory"
      >
        <ion-select-option
          *ngFor="let item of waterDamageCategories; let i = index"
          [value]="item.value"
        >
          {{ item.name }}</ion-select-option
        >
      </ion-select>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Water Damage Class</ion-label>
      <ion-select
        interface="popover"
        name="waterDamageClass"
        #waterDamageClass="ngModel"
        [disabled]="scheduling.syncInfo.isSync"
        [(ngModel)]="scheduling.waterDamageClass"
      >
        <ion-select-option
          *ngFor="let item of waterDamageClasses; let i = index"
          [value]="item.value"
        >
          {{ item.name }}</ion-select-option
        >
      </ion-select>
    </ion-item>

    <div id="insurance">
      <ion-item lines="none">
        <ion-label>Insurance Company</ion-label>
      </ion-item>

      <ion-item
        lines="none"
        class="no-padding"
        *ngIf="!scheduling.syncInfo.isSync"
      >
        <ion-chip
          *ngIf="!scheduling.syncInfo.isSync"
          color="primary"
          (click)="searchContact('insurance')"
          slot="end"
          [disabled]=" !scheduling.serviceType"
        >
          <ion-label>Contact</ion-label>
          <ion-icon name="person-circle-outline"></ion-icon>
        </ion-chip>
        <ion-chip
          color="secondary"
          (click)="searchCompany('insurance')"
          slot="end"
          [disabled]=" !scheduling.serviceType"
        >
          <ion-label>Company</ion-label>
          <ion-icon name="briefcase-outline"></ion-icon>
        </ion-chip>
      </ion-item>

      <ion-item *ngIf="scheduling.insuranceCompanyContact">
        <ion-avatar slot="start">
          <img src="../../../assets/images/avatar.svg" />
        </ion-avatar>
        <ion-label>
          <h3>
            {{scheduling.insuranceCompanyContact.firstName + " " +
            scheduling.insuranceCompanyContact.lastName}}
          </h3>
          <p>{{scheduling.insuranceCompanyContact.phone}}</p>
          <p>{{scheduling.insuranceCompanyContact.email}}</p>
        </ion-label>
      </ion-item>

      <ion-item *ngIf="scheduling.insuranceCompany">
        <ion-avatar slot="start">
          <img src="../../../assets/images/avatar.svg" />
        </ion-avatar>
        <ion-label>
          <h3>{{scheduling.insuranceCompany.title}}</h3>
          <p>{{scheduling.insuranceCompany.type}}</p>
          <p>{{scheduling.insuranceCompany.phone}}</p>
          <p>{{scheduling.insuranceCompany.email}}</p>
        </ion-label>
      </ion-item>
    </div>
    <div id="referal">
      <ion-item lines="none">
        <ion-label>Referal Partner</ion-label>
      </ion-item>
      <ion-item
        lines="none"
        class="no-padding"
        *ngIf="!scheduling.syncInfo.isSync"
      >
        <ion-chip
          *ngIf="!scheduling.syncInfo.isSync"
          color="primary"
          (click)="searchContact('referal')"
          slot="end"
          [disabled]=" !scheduling.serviceType"
        >
          <ion-label>Contact</ion-label>
          <ion-icon name="person-circle-outline"></ion-icon>
        </ion-chip>
        <ion-chip
          color="secondary"
          (click)="searchCompany('referal')"
          slot="end"
          [disabled]=" !scheduling.serviceType"
        >
          <ion-label>Company</ion-label>
          <ion-icon name="briefcase-outline"></ion-icon>
        </ion-chip>
      </ion-item>
      <ion-item *ngIf="scheduling.referalPartner">
        <ion-avatar slot="start">
          <img src="../../../assets/images/avatar.svg" />
        </ion-avatar>
        <ion-label>
          <h3>
            {{scheduling.referalPartner.firstName + " " +
            scheduling.referalPartner.lastName}}
          </h3>
          <p>{{scheduling.referalPartner.phone}}</p>
          <p>{{scheduling.referalPartner.email}}</p>
        </ion-label>
      </ion-item>

      <ion-item *ngIf="scheduling.referalPartnerCompany">
        <ion-avatar slot="start">
          <img src="../../../assets/images/avatar.svg" />
        </ion-avatar>
        <ion-label>
          <h3>{{scheduling.referalPartnerCompany.title}}</h3>
          <p>{{scheduling.referalPartnerCompany.type}}</p>
          <p>{{scheduling.referalPartnerCompany.phone}}</p>
          <p>{{scheduling.referalPartnerCompany.email}}</p>
        </ion-label>
      </ion-item>
    </div>

    <ion-item lines="full">
      <ion-item>
        <ion-label>Open Claims</ion-label>
        <ion-toggle
          name="openClaims"
          #openClaims="ngModel"
          [(ngModel)]="scheduling.openClaims"
          slot="start"
          name="cherry"
          [disabled]="scheduling.syncInfo.isSync"
          color="danger"
        ></ion-toggle>
      </ion-item>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Select Employee</ion-label>
      <ion-select
        name="inspectorUserId"
        #inspectorUserId="ngModel"
        [disabled]="scheduling.syncInfo.isSync"
        [(ngModel)]="scheduling.inspectorUserId"
        interface="popover"
        required
      >
        <ion-select-option
          *ngFor="let item of inspectorsList; let i = index"
          [value]="item.userId"
        >
          {{ item.completeName }}</ion-select-option
        >
      </ion-select>
    </ion-item>
    <div class="validation-errors">
      <div
        *ngIf="inspectorUserId.errors && (inspectorUserId.dirty || inspectorUserId.touched) "
      >
        <p *ngIf="inspectorUserId.errors.required">
          <ion-icon color="danger" name="information-circle-outline"></ion-icon>
          <ion-label color="danger"> Required </ion-label>
        </p>
      </div>
    </div>

    <div class="validation-errors">
      <div
        *ngIf="serviceType.errors && (serviceType.dirty || serviceType.touched) "
      >
        <p *ngIf="serviceType.errors.required">
          <ion-icon color="danger" name="information-circle-outline"></ion-icon>
          <ion-label color="danger"> Required </ion-label>
        </p>
      </div>
    </div>

    <ion-item>
      <ion-label position="floating">Select date</ion-label>
      <!-- <ion-datetime
        [min]="minDate"
        [max]="maxDate"
        formControlName="scheduleDateTime"
        class="form-controll"
        placeholder="Select Date"
      ></ion-datetime> -->

      <ion-datetime
        [min]="minDate"
        [max]="maxDate"
        [disabled]="scheduling.syncInfo.isSync"
        name="scheduleDateTime"
        #scheduleDateTime="ngModel"
        [(ngModel)]="scheduling.scheduleDateTime"
        displayFormat="MMMM DD, YYYY"
        pickerFormat="MMMM DD YYYY "
      ></ion-datetime>
    </ion-item>

    <ion-item>
      <ion-label position="floating">Select Hour</ion-label>
      <!-- <ion-datetime
        [min]="minDate"
        [max]="maxDate"
        formControlName="scheduleDateTime"
        class="form-controll"
        placeholder="Select Date"
      ></ion-datetime> -->

      <ion-datetime
        [min]="minDate"
        [max]="maxDate"
        name="scheduleDateTime"
        [disabled]="scheduling.syncInfo.isSync"
        minuteValues="0,15,30,45"
        #scheduleDateTime="ngModel"
        [(ngModel)]="selectedDate"
        displayFormat="h:mm A"
        pickerFormat="h:mm A"
        (ionChange)="hourChanged()"
      ></ion-datetime>
    </ion-item>

    <ion-row class="ion-padding" *ngIf="scheduling.internalStatus == 'New'">
      <ion-col>
        <ion-button
          full
          (click)="onSubmit()"
          expand="block"
          [disabled]="! 
          ( scheduling.serviceAddress && !serviceAddress.errors   
          && scheduling.notes && !notes.errors          
          && scheduling.inspectorUserId && !inspectorUserId.errors
          && scheduling.serviceType && !serviceType.errors          
          && scheduling.scheduleDateTime && !scheduleDateTime.errors
          && scheduling.contact && scheduling.contact.firstName 
          )"
          >Submit</ion-button
        >
      </ion-col>
    </ion-row>
  </form>
</ion-content>
